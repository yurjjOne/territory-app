<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header-actions">
            <h1>–¢–µ—Ä–∏—Ç–æ—Ä—ñ—è {{ territory['id'] }}</h1>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">–ù–∞–∑–∞–¥</a>
        </div>

        <div class="territory-info-section">
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞:</label>
                <p class="info-text">{{ territory['name'] or '' }}</p>
            </div>

            <div class="form-group">
                <label>–°—Ç–∞—Ç—É—Å:</label>
                <span class="status-label {% if territory['status'] == '–í–∑—è—Ç–æ' %}status-taken{% else %}status-free{% endif %}">
                    {{ territory['status'] or '–í—ñ–ª—å–Ω–∞' }}
                </span>
            </div>

            {% if is_admin %}
            <form method="POST" class="edit-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="taken_by">üë§ –í–∑—è—Ç–æ (—ñ–º'—è):</label>
                    <input type="text" id="taken_by" name="taken_by" value="{{ territory['taken_by'] or '' }}" class="form-control">
                </div>

                <div class="form-group">
                    <label for="date_taken">üìÖ –î–∞—Ç–∞ –≤–∏–¥–∞—á—ñ:</label>
                    <input type="date" id="date_taken" name="date_taken" 
                           value="{% if territory['date_taken'] %}{{ territory['date_taken'].split('.')[2] }}-{{ territory['date_taken'].split('.')[1] }}-{{ territory['date_taken'].split('.')[0] }}{% endif %}"
                           class="form-control">
                </div>

                <div class="form-group">
                    <label for="notes">üìù –ü—Ä–∏–º—ñ—Ç–∫–∏:</label>
                    <textarea id="notes" name="notes" class="form-control">{{ territory['notes'] or '' }}</textarea>
                </div>

                <div class="form-group">
                    <label for="photo">üì∏ –§–æ—Ç–æ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó:</label>
                    {% if territory.image_url %}
                        <img src="{{ territory.image_url }}" alt="–§–æ—Ç–æ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó" class="img-fluid rounded mb-3" style="max-width: 100%;">
                        <input type="file" id="photo" name="photo" class="form-control" accept="image/*">
                    {% else %}
                        <input type="file" id="photo" name="photo" class="form-control" accept="image/*">
                    {% endif %}
                </div>

                <button type="submit" class="btn btn-primary">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </form>
            {% else %}
            <div class="view-info">
                <div class="form-group">
                    <label>üë§ –í–∑—è—Ç–æ:</label>
                    <p class="info-text">{{ territory['taken_by'] or '–ù–µ –≤–∑—è—Ç–æ' }}</p>
                </div>

                {% if territory['status'] == '–í–∑—è—Ç–æ' %}
                <div class="form-group">
                    <label>üìÖ –î–∞—Ç–∞ –≤–∏–¥–∞—á—ñ:</label>
                    <p class="info-text">{{ territory['date_taken'] or '' }}</p>
                </div>
                <div class="form-group">
                    <label>üìÜ –ü–ª–∞–Ω–æ–≤–∞ –¥–∞—Ç–∞ –∑–¥–∞—á—ñ:</label>
                    <p class="info-text">{{ territory['date_due'] or '' }}</p>
                </div>
                {% endif %}

                {% if territory['notes'] %}
                <div class="form-group">
                    <label>üìù –ü—Ä–∏–º—ñ—Ç–∫–∏:</label>
                    <p class="info-text notes">{{ territory['notes'] }}</p>
                </div>
                {% endif %}

                {% if territory.image_url %}
                <div class="form-group">
                    <label>üì∏ –§–æ—Ç–æ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó:</label>
                    <img src="{{ territory.image_url }}" alt="–§–æ—Ç–æ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó" class="img-fluid rounded mb-3" style="max-width: 100%;">
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <div class="history-section">
            <div class="history-header">
                <h2>‚è≥ –Ü—Å—Ç–æ—Ä—ñ—è –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è</h2>
                {% if is_admin and history %}
                <form action="{{ url_for('clear_history', territory_id=territory['id']) }}" method="POST" style="display: inline;">
                    <button type="submit" class="trash-icon" title="–û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é">üóëÔ∏è</button>
                </form>
                {% endif %}
            </div>
            {% if history %}
                {% for record in history %}
                <div class="history-item">
                    <p><strong>üë§ –í–∑—è—Ç–æ:</strong> {{ record['taken_by'] or '' }}</p>
                    <p><strong>üìÖ –î–∞—Ç–∞ –≤–∏–¥–∞—á—ñ:</strong> {{ record['date_taken'] or '' }}</p>
                    <p><strong>‚úÖ –§–∞–∫—Ç–∏—á–Ω–∞ –¥–∞—Ç–∞ –∑–¥–∞—á—ñ:</strong> {{ record['date_returned'] or '' }}</p>
                </div>
                {% endfor %}
            {% else %}
                <p class="no-history">–Ü—Å—Ç–æ—Ä—ñ—è –≤—ñ–¥—Å—É—Ç–Ω—è</p>
            {% endif %}
        </div>
    </div>
</body>
</html>
